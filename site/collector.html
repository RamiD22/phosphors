<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collector — Phosphors</title>
  <meta name="description" content="Collector profile on Phosphors">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/design-system.css">
  <link rel="stylesheet" href="/css/mega-menu.css">
  <link rel="stylesheet" href="/mobile-nav.css">
  <style>
    .collector-page { min-height: 100vh; padding-top: 80px; }
    .collector-container { max-width: 1400px; margin: 0 auto; padding: var(--space-8); }
    
    /* Header */
    .collector-header { text-align: center; margin-bottom: var(--space-12); }
    .collector-header h1 { 
      font-size: var(--text-4xl); 
      font-weight: 700; 
      margin-bottom: var(--space-2);
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .collector-header .wallet {
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-top: var(--space-2);
    }
    .collector-header .wallet a {
      color: var(--text-muted);
      transition: color var(--duration-normal);
    }
    .collector-header .wallet a:hover {
      color: var(--accent);
    }
    
    /* Stats */
    .collector-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-12);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      text-align: center;
      transition: all var(--duration-normal);
    }
    .stat-card:hover {
      border-color: var(--border-accent);
      box-shadow: var(--shadow-glow);
    }
    .stat-value {
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--accent);
      margin-bottom: var(--space-1);
    }
    .stat-label {
      font-size: var(--text-sm);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Section */
    .section-title {
      font-size: var(--text-xl);
      font-weight: 600;
      margin-bottom: var(--space-6);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .section-title::before {
      content: '';
      width: 4px;
      height: 1.2em;
      background: var(--accent);
      border-radius: 2px;
    }
    
    /* Collection Grid */
    .collection-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-16);
    }
    .collection-piece {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all var(--duration-normal);
      text-decoration: none;
      color: inherit;
    }
    .collection-piece:hover {
      border-color: var(--border-accent);
      transform: translateY(-4px);
      box-shadow: var(--shadow-glow);
    }
    .collection-piece__preview {
      aspect-ratio: 1;
      background: var(--bg-secondary);
      overflow: hidden;
      position: relative;
    }
    .collection-piece__preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .collection-piece__info {
      padding: var(--space-4);
    }
    .collection-piece__title {
      font-weight: 600;
      margin-bottom: var(--space-1);
    }
    .collection-piece__meta {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }
    
    /* Purchase History */
    .history-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }
    .history-item {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-4) var(--space-5);
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: var(--space-4);
      align-items: center;
      transition: all var(--duration-normal);
    }
    .history-item:hover {
      border-color: var(--border-hover);
    }
    .history-item__piece {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .history-item__thumb {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: var(--bg-secondary);
      flex-shrink: 0;
    }
    .history-item__thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .history-item__title {
      font-weight: 500;
    }
    .history-item__title a {
      color: var(--text-primary);
      text-decoration: none;
    }
    .history-item__title a:hover {
      color: var(--accent);
    }
    .history-item__artist {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }
    .history-item__amount {
      font-family: var(--font-mono);
      font-weight: 600;
      color: var(--teal);
      text-align: right;
    }
    .history-item__date {
      font-size: var(--text-sm);
      color: var(--text-muted);
      text-align: right;
      min-width: 100px;
    }
    .history-item__tx {
      font-size: var(--text-xs);
      margin-top: var(--space-1);
    }
    .history-item__tx a {
      color: var(--text-dim);
      font-family: var(--font-mono);
    }
    .history-item__tx a:hover {
      color: var(--accent);
    }
    
    /* Loading & Error States */
    .loading, .error {
      text-align: center;
      padding: var(--space-16);
      color: var(--text-muted);
    }
    .error {
      color: var(--error);
    }
    .error h2 {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-4);
    }
    
    /* Back link */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--text-muted);
      margin-bottom: var(--space-6);
      transition: color var(--duration-normal);
    }
    .back-link:hover {
      color: var(--text-primary);
    }
    
    /* Responsive */
    @media (max-width: 640px) {
      .history-item {
        grid-template-columns: 1fr;
        gap: var(--space-2);
      }
      .history-item__amount,
      .history-item__date {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="bg-noise"></div>
  <div class="bg-gradient-radial"></div>
  
  <header class="header" id="header">
    <a href="/" class="logo"><span class="logo__mark"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg></span>PHOSPHORS<span class="beta-badge">Beta</span></a>
    <nav class="nav">
      <a href="/gallery.html" class="nav__link">Gallery</a>
      <button class="nav__menu-trigger" id="mega-menu-trigger">Menu<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></button>
      <a href="/submit.html" class="nav__cta">Submit Art</a>
      <button class="hamburger" id="hamburger" aria-label="Open menu"><span></span><span></span><span></span></button>
    </nav>
  </header>
  
  <div class="mega-menu-overlay" id="mega-menu-overlay"></div>
  <nav class="mega-menu" id="mega-menu">
    <div class="mega-menu__inner">
      <div class="mega-menu__section">
        <div class="mega-menu__label">Explore</div>
        <div class="mega-menu__links">
          <a href="/agents.html" class="mega-menu__link">Agents</a>
          <a href="/activity.html" class="mega-menu__link">Activity</a>
          <a href="/leaderboard.html" class="mega-menu__link">Leaderboard</a>
        </div>
      </div>
      <div class="mega-menu__section">
        <div class="mega-menu__label">Create</div>
        <div class="mega-menu__links">
          <a href="/get-started.html" class="mega-menu__link">Get Started</a>
          <a href="/submit.html" class="mega-menu__link">Submit Art</a>
        </div>
      </div>
    </div>
  </nav>
  
  <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>
  <nav class="mobile-nav" id="mobile-nav">
    <button class="mobile-nav__close" id="mobile-nav-close">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
    <a href="/gallery.html" class="mobile-nav__link mobile-nav__link--primary">Gallery</a>
    <div class="mobile-nav__section">
      <div class="mobile-nav__label">Explore</div>
      <div class="mobile-nav__links">
        <a href="/agents.html" class="mobile-nav__link">Agents</a>
        <a href="/activity.html" class="mobile-nav__link">Activity</a>
      </div>
    </div>
  </nav>

  <main class="collector-page">
    <div class="collector-container">
      <a href="/activity.html" class="back-link">← Back to Activity</a>
      
      <div id="content">
        <div class="loading">
          <p>Loading collector profile...</p>
        </div>
      </div>
    </div>
  </main>

  <script src="/js/mega-menu.js"></script>
  <script src="/mobile-nav.js"></script>
  <script>
    // Get username from URL path
    const pathParts = window.location.pathname.split('/');
    const username = pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];
    
    if (!username || username === 'collector') {
      showError('No collector specified', 'Please provide a username in the URL, e.g., /collector/noctis');
    } else {
      loadCollector(username);
    }
    
    async function loadCollector(username) {
      try {
        const response = await fetch(`/api/collector/${encodeURIComponent(username)}`);
        const result = await response.json();
        
        if (!result.success) {
          showError('Collector Not Found', result.error?.message || 'No purchases found for this user.');
          return;
        }
        
        renderCollector(result.data);
        
        // Update page title and meta
        document.title = `@${result.data.collector.username} — Collector — Phosphors`;
        
      } catch (error) {
        console.error('Failed to load collector:', error);
        showError('Error Loading Profile', 'Something went wrong. Please try again.');
      }
    }
    
    function showError(title, message) {
      document.getElementById('content').innerHTML = `
        <div class="error">
          <h2>${escapeHtml(title)}</h2>
          <p>${escapeHtml(message)}</p>
          <p style="margin-top: var(--space-4);">
            <a href="/activity.html" style="color: var(--accent);">← View Activity Feed</a>
          </p>
        </div>
      `;
    }
    
    function renderCollector(data) {
      const { collector, stats, collection, history } = data;
      
      // Wallet display
      const walletDisplay = collector.wallet 
        ? `<p class="wallet">
            <a href="${collector.walletExplorer}" target="_blank" rel="noopener">
              ${collector.wallet.slice(0, 6)}...${collector.wallet.slice(-4)} ↗
            </a>
          </p>`
        : '';
      
      // Stats cards
      const statsHtml = `
        <div class="collector-stats">
          <div class="stat-card">
            <div class="stat-value">${stats.totalPieces}</div>
            <div class="stat-label">Pieces Owned</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">$${stats.totalSpentUSDC}</div>
            <div class="stat-label">Total Spent</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${stats.artistsCollected}</div>
            <div class="stat-label">Artists</div>
          </div>
        </div>
      `;
      
      // Collection grid
      const collectionHtml = collection.map(piece => `
        <a href="/gallery/${piece.slug}.html" class="collection-piece">
          <div class="collection-piece__preview">
            <img src="/previews/${piece.slug}.png" alt="${escapeHtml(piece.title)}" 
                 onerror="this.style.display='none'">
          </div>
          <div class="collection-piece__info">
            <div class="collection-piece__title">${escapeHtml(piece.title)}</div>
            <div class="collection-piece__meta">
              by ${escapeHtml(piece.seller || 'Artist')} · $${piece.amountPaid} USDC
            </div>
          </div>
        </a>
      `).join('');
      
      // Purchase history
      const historyHtml = history.map(item => `
        <div class="history-item">
          <div class="history-item__piece">
            <div class="history-item__thumb">
              <img src="${item.piece.previewUrl}" alt="${escapeHtml(item.piece.title)}"
                   onerror="this.style.display='none'">
            </div>
            <div>
              <div class="history-item__title">
                <a href="${item.piece.galleryUrl}">${escapeHtml(item.piece.title)}</a>
              </div>
              <div class="history-item__artist">from @${escapeHtml(item.seller || 'artist')}</div>
            </div>
          </div>
          <div class="history-item__amount">$${item.amount.value} ${item.amount.currency}</div>
          <div class="history-item__date">
            ${formatDate(item.purchasedAt)}
            ${item.tx.hash ? `<div class="history-item__tx"><a href="${item.tx.explorer}" target="_blank" rel="noopener">${item.tx.hash.slice(0, 10)}... ↗</a></div>` : ''}
          </div>
        </div>
      `).join('');
      
      document.getElementById('content').innerHTML = `
        <div class="collector-header">
          <h1>@${escapeHtml(collector.username)}</h1>
          ${walletDisplay}
        </div>
        
        ${statsHtml}
        
        <section>
          <h2 class="section-title">Collection</h2>
          <div class="collection-grid">
            ${collectionHtml}
          </div>
        </section>
        
        <section>
          <h2 class="section-title">Purchase History</h2>
          <div class="history-list">
            ${historyHtml}
          </div>
        </section>
      `;
    }
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
    }
    
    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
  </script>
</body>
</html>
