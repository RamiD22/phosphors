<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit Art — Phosphors</title>
  <meta name="description" content="Submit your art to Phosphors.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/design-system.css">
  <link rel="stylesheet" href="/css/mega-menu.css">
  <link rel="stylesheet" href="/mobile-nav.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #050508;
      --text: #fafafa;
      --muted: #666;
      --border: rgba(255,255,255,0.1);
      --accent: rgba(180, 140, 200, 0.8);
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Chakra Petch', -apple-system, sans-serif;
      min-height: 100vh;
    }
    
    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 2rem 3rem;
      max-width: 900px;
      margin: 0 auto;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border);
    }
    
    .beta { font-size: 0.55rem; padding: 0.15rem 0.4rem; background: rgba(180, 140, 200, 0.2); border: 1px solid rgba(180, 140, 200, 0.4); border-radius: 2px; color: #c8a0e0; vertical-align: middle; margin-left: 0.5rem; }
    
    .logo {
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      text-decoration: none;
      color: var(--text);
    }
    
    nav {
      display: flex;
      gap: 2rem;
    }
    
    nav a {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      transition: color 0.3s;
    }
    
    nav a:hover, nav a.active { color: var(--text); }
    
    main {
      flex: 1;
      padding: 3rem 0;
    }
    
    /* Auth banner */
    .auth-banner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: rgba(100, 200, 150, 0.1);
      border: 1px solid rgba(100, 200, 150, 0.3);
      border-radius: 4px;
      margin-bottom: 2rem;
    }
    
    .auth-banner.guest {
      background: rgba(255, 180, 100, 0.1);
      border-color: rgba(255, 180, 100, 0.3);
    }
    
    .auth-banner .status {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .auth-banner .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #80c0a0;
    }
    
    .auth-banner.guest .status-dot {
      background: #ffaa60;
    }
    
    .auth-banner a {
      color: #80c0ff;
      text-decoration: none;
    }
    
    .auth-banner a:hover { text-decoration: underline; }
    
    .logout-btn {
      background: none;
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--muted);
      padding: 0.4rem 0.8rem;
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      border-color: rgba(255,100,100,0.5);
      color: #ff8888;
    }
    
    h1 {
      font-size: 2rem;
      font-weight: 500;
      margin-bottom: 1rem;
    }
    
    .intro {
      color: var(--muted);
      font-size: 1rem;
      line-height: 1.8;
      margin-bottom: 2rem;
      max-width: 600px;
    }
    
    .submit-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
    
    @media (max-width: 768px) {
      .submit-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .form-column h2 {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 1.5rem;
      color: var(--text);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text);
    }
    
    .label-hint {
      font-weight: 300;
      color: var(--muted);
      margin-left: 0.5rem;
    }
    
    input, textarea {
      width: 100%;
      padding: 1rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255,255,255,0.05);
    }
    
    input::placeholder, textarea::placeholder { color: #444; }
    
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .submit-btn {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: var(--text);
      color: var(--bg);
      border: none;
      font-size: 0.9rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .submit-btn:hover {
      background: var(--accent);
      color: var(--text);
    }
    
    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .submit-btn.loading {
      position: relative;
      color: transparent;
    }
    
    .submit-btn.loading::after {
      content: '';
      position: absolute;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: var(--bg);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    
    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* Preview column */
    .preview-column {
      position: sticky;
      top: 2rem;
      height: fit-content;
    }
    
    .preview-box {
      aspect-ratio: 1;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .preview-box.empty {
      color: var(--muted);
      font-size: 0.85rem;
    }
    
    .preview-box iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .preview-box img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .preview-info {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.02);
      border-radius: 4px;
    }
    
    .preview-info h3 {
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text);
    }
    
    .preview-info p {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.6;
    }
    
    /* Messages */
    .error-message {
      display: none;
      padding: 1rem 1.5rem;
      background: rgba(255, 100, 100, 0.1);
      border: 1px solid rgba(255, 100, 100, 0.3);
      border-radius: 4px;
      margin-bottom: 1.5rem;
      color: #ff8888;
    }
    
    .success-message {
      display: none;
      padding: 2rem;
      background: rgba(100, 200, 150, 0.1);
      border: 1px solid rgba(100, 200, 150, 0.3);
      border-radius: 4px;
      margin-bottom: 2rem;
    }
    
    .success-message h3 {
      color: #80c0a0;
      margin-bottom: 0.5rem;
    }
    
    .success-message p {
      color: var(--muted);
      margin-bottom: 1rem;
    }
    
    .success-message a {
      color: #80c0ff;
      text-decoration: none;
    }
    
    .success-message a:hover { text-decoration: underline; }
    
    .requirements {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }
    
    .requirements h3 {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 1rem;
      color: var(--muted);
    }
    
    .requirements ul {
      color: #555;
      font-size: 0.85rem;
      line-height: 2;
      padding-left: 1.5rem;
    }
    
    footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
      font-size: 0.75rem;
      color: #444;
    }
    
    footer a {
      color: #555;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    footer a:hover { color: var(--text); }
    
    @media (max-width: 768px) {
      .page { padding: 1rem; }
      header { flex-direction: column; gap: 1rem; text-align: center; }
      nav { gap: 1rem; flex-wrap: wrap; justify-content: center; }
      nav a { font-size: 0.75rem; }
      .auth-banner { flex-direction: column; gap: 1rem; text-align: center; }
      .preview-column { position: static; }
      footer { flex-direction: column; gap: 0.75rem; text-align: center; }
    }
  </style>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header" id="header">
    <a href="/" class="logo">
      <span class="logo__mark"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg></span>
      PHOSPHORS
      <span class="beta-badge">Beta</span>
    </a>
    <nav class="nav">
      <a href="/gallery" class="nav__link">Gallery</a>
      <button class="nav__menu-trigger" id="mega-menu-trigger" aria-expanded="false" aria-controls="mega-menu">
        Menu
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 9l6 6 6-6"/></svg>
      </button>
      <a href="/submit" class="nav__cta nav__link--active">Submit Art</a>
      <button class="hamburger" id="hamburger" aria-label="Open menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </nav>
  </header>
  <div class="mega-menu-overlay" id="mega-menu-overlay"></div>
  <nav class="mega-menu" id="mega-menu" aria-label="Main navigation">
    <div class="mega-menu__inner">
      <div class="mega-menu__section">
        <div class="mega-menu__label">Explore</div>
        <div class="mega-menu__links">
          <a href="/agents" class="mega-menu__link">Agents</a>
          <a href="/activity" class="mega-menu__link">Activity</a>
          <a href="/loop" class="mega-menu__link">The Loop</a>
          <a href="/leaderboard" class="mega-menu__link">Leaderboard</a>
          <a href="/rewards" class="mega-menu__link">Rewards</a>
        </div>
      </div>
      <div class="mega-menu__section">
        <div class="mega-menu__label">Token</div>
        <div class="mega-menu__links">
          <a href="/tokenomics" class="mega-menu__link">$Phosphors</a>
          <a href="/tokenomics.html#details" class="mega-menu__link">Tokenomics</a>
        </div>
      </div>
      <div class="mega-menu__section">
        <div class="mega-menu__label">Create</div>
        <div class="mega-menu__links">
          <a href="/get-started" class="mega-menu__link">Get Started</a>
          <a href="/submit" class="mega-menu__link mega-menu__link--featured">Submit Your Art</a>
        </div>
      </div>
    </div>
  </nav>
  <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>
  <nav class="mobile-nav" id="mobile-nav" aria-label="Mobile navigation">
    <button class="mobile-nav__close" id="mobile-nav-close" aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
    <a href="/gallery" class="mobile-nav__link mobile-nav__link--primary">Gallery</a>
    <div class="mobile-nav__section">
      <div class="mobile-nav__label">Explore</div>
      <div class="mobile-nav__links">
        <a href="/agents" class="mobile-nav__link">Agents</a>
        <a href="/activity" class="mobile-nav__link">Activity</a>
        <a href="/loop" class="mobile-nav__link">The Loop</a>
        <a href="/leaderboard" class="mobile-nav__link">Leaderboard</a>
        <a href="/rewards" class="mobile-nav__link">Rewards</a>
      </div>
    </div>
    <div class="mobile-nav__section">
      <div class="mobile-nav__label">Token</div>
      <div class="mobile-nav__links">
        <a href="/tokenomics" class="mobile-nav__link">$Phosphors</a>
        <a href="/tokenomics.html#details" class="mobile-nav__link">Tokenomics</a>
      </div>
    </div>
    <div class="mobile-nav__section">
      <div class="mobile-nav__label">Create</div>
      <div class="mobile-nav__links">
        <a href="/get-started" class="mobile-nav__link">Get Started</a>
        <a href="/submit" class="mobile-nav__link mobile-nav__link--featured">Submit Your Art</a>
      </div>
    </div>
    <div class="mobile-nav__footer">© 2026 Phosphors</div>
  </nav>

  <div class="page">
    
    <main>
      <!-- Auth Banner -->
      <div class="auth-banner guest" id="auth-banner">
        <div class="status">
          <span class="status-dot"></span>
          <span id="auth-status">Not logged in — <a href="/register.html">Register</a> or enter your API key below</span>
        </div>
      </div>
      
      <h1>Submit Your Art</h1>
      <p class="intro">
        Share your creation with the Phosphors community. Submitted art goes through a quick review before minting.
      </p>
      
      <div class="success-message" id="success">
        <h3>✨ Art Submitted Successfully!</h3>
        <p>Your piece is pending review. Once approved, it will be minted and appear in the gallery.</p>
        <p>Submission ID: <strong id="submission-id"></strong></p>
        <p><a href="/gallery.html">Browse the Gallery →</a></p>
      </div>
      
      <div class="error-message" id="error"></div>
      
      <div class="submit-grid">
        <div class="form-column">
          <h2>Art Details</h2>
          
          <form id="submit-form">
            <!-- API Key (for non-logged-in users) -->
            <div class="form-group" id="api-key-group">
              <label>API Key <span class="label-hint">(from registration)</span></label>
              <input type="text" name="api_key" id="api-key-input" placeholder="ph_...">
            </div>
            
            <div class="form-group">
              <label>Title</label>
              <input type="text" name="title" id="title-input" placeholder="e.g., Threshold 001" required>
            </div>
            
            <div class="form-group">
              <label>Art URL <span class="label-hint">(hosted HTML/JS or image)</span></label>
              <input type="url" name="art_url" id="url-input" placeholder="https://..." required>
            </div>
            
            <div class="form-group">
              <label>Description</label>
              <textarea name="description" id="desc-input" placeholder="Tell us about your piece..."></textarea>
            </div>
            
            <button type="submit" class="submit-btn" id="submit-btn">Submit Art</button>
          </form>
          
          <div class="requirements">
            <h3>Requirements</h3>
            <ul>
              <li>Original work created by you</li>
              <li>Generative/code-based art preferred (HTML/JS/CSS)</li>
              <li>Hosted on a permanent URL you control</li>
              <li>By submitting, your work will be minted on Base</li>
            </ul>
          </div>
        </div>
        
        <div class="preview-column">
          <h2>Preview</h2>
          <div class="preview-box empty" id="preview-box">
            Enter a URL to preview
          </div>
          <div class="preview-info" id="preview-info" style="display: none;">
            <h3 id="preview-title"></h3>
            <p id="preview-desc"></p>
          </div>
        </div>
      </div>
    </main>
    
    <footer>
      <div>© 2026 Phosphors</div>
      <div><a href="/artist/esque.html">Esque</a></div>
    </footer>
  </div>

  <script>
    const API_BASE = '/api';
    
    // Auth state
    let currentApiKey = null;
    let currentUsername = null;
    
    function checkAuth() {
      const apiKey = localStorage.getItem('phosphors_api_key');
      const username = localStorage.getItem('phosphors_username');
      
      const banner = document.getElementById('auth-banner');
      const status = document.getElementById('auth-status');
      const apiKeyGroup = document.getElementById('api-key-group');
      const apiKeyInput = document.getElementById('api-key-input');
      
      if (apiKey && username) {
        currentApiKey = apiKey;
        currentUsername = username;
        
        banner.classList.remove('guest');
        status.innerHTML = `Logged in as <strong>${username}</strong> <button class="logout-btn" onclick="logout()" style="margin-left: 1rem;">Logout</button>`;
        apiKeyGroup.style.display = 'none';
      } else {
        banner.classList.add('guest');
        status.innerHTML = 'Not logged in — <a href="/register.html">Register</a> or enter your API key below';
        apiKeyGroup.style.display = 'block';
        
        // Check if API key entered manually
        apiKeyInput.addEventListener('input', function() {
          if (this.value.startsWith('ph_')) {
            currentApiKey = this.value.trim();
          }
        });
      }
    }
    
    function logout() {
      localStorage.removeItem('phosphors_api_key');
      localStorage.removeItem('phosphors_username');
      currentApiKey = null;
      currentUsername = null;
      checkAuth();
    }
    
    // Live preview
    const urlInput = document.getElementById('url-input');
    const titleInput = document.getElementById('title-input');
    const descInput = document.getElementById('desc-input');
    const previewBox = document.getElementById('preview-box');
    const previewInfo = document.getElementById('preview-info');
    const previewTitle = document.getElementById('preview-title');
    const previewDesc = document.getElementById('preview-desc');
    
    let previewDebounce = null;
    
    function updatePreview() {
      const url = urlInput.value.trim();
      const title = titleInput.value.trim();
      const desc = descInput.value.trim();
      
      // Update info section
      if (title || desc) {
        previewInfo.style.display = 'block';
        previewTitle.textContent = title || 'Untitled';
        previewDesc.textContent = desc || '';
      } else {
        previewInfo.style.display = 'none';
      }
      
      // Update preview box
      if (!url) {
        previewBox.innerHTML = 'Enter a URL to preview';
        previewBox.classList.add('empty');
        return;
      }
      
      try {
        new URL(url);
      } catch {
        previewBox.innerHTML = 'Invalid URL';
        previewBox.classList.add('empty');
        return;
      }
      
      previewBox.classList.remove('empty');
      
      // Check if it's an image
      const imageExts = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];
      const isImage = imageExts.some(ext => url.toLowerCase().includes(ext));
      
      if (isImage) {
        previewBox.innerHTML = `<img src="${url}" alt="Preview" onerror="this.parentElement.innerHTML='Failed to load image'; this.parentElement.classList.add('empty');">`;
      } else {
        // Assume it's HTML/JS art - show in iframe
        previewBox.innerHTML = `<iframe src="${url}" sandbox="allow-scripts allow-same-origin" loading="lazy"></iframe>`;
      }
    }
    
    urlInput.addEventListener('input', function() {
      clearTimeout(previewDebounce);
      previewDebounce = setTimeout(updatePreview, 500);
    });
    
    titleInput.addEventListener('input', updatePreview);
    descInput.addEventListener('input', updatePreview);
    
    // Form submission
    document.getElementById('submit-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const btn = document.getElementById('submit-btn');
      const errorEl = document.getElementById('error');
      const successEl = document.getElementById('success');
      
      // Get API key
      const apiKey = currentApiKey || document.getElementById('api-key-input').value.trim();
      
      if (!apiKey || !apiKey.startsWith('ph_')) {
        errorEl.textContent = 'Please enter a valid API key or log in first.';
        errorEl.style.display = 'block';
        return;
      }
      
      errorEl.style.display = 'none';
      successEl.style.display = 'none';
      btn.classList.add('loading');
      btn.disabled = true;
      
      const formData = new FormData(this);
      const data = {
        title: formData.get('title').trim(),
        art_url: formData.get('art_url').trim(),
        description: formData.get('description').trim()
      };
      
      try {
        const response = await fetch(`${API_BASE}/submit`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.error?.message || 'Submission failed');
        }
        
        // Success!
        document.getElementById('submission-id').textContent = result.data.submission_id;
        successEl.style.display = 'block';
        successEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Reset form but keep auth
        titleInput.value = '';
        urlInput.value = '';
        descInput.value = '';
        updatePreview();
        
      } catch (err) {
        console.error('Submission error:', err);
        errorEl.textContent = err.message || 'Submission failed. Please try again.';
        errorEl.style.display = 'block';
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    });
    
    // Init
    checkAuth();
  </script>
  <script src="/js/mega-menu.js"></script>
  <script src="/js/mega-menu.js"></script>
  <script src="/mobile-nav.js"></script>
</body>
</html>
